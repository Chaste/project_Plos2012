% Template for PLoS
% Version 1.0 January 2009
%
% To compile to PDF, run:
% latex plos.template
% bibtex plos.template
% latex plos.template
% latex plos.template
% dvipdf plos.template

% DO NOT EDIT - PLoS STYLE
\documentclass[10pt]{article}

% amsmath package, useful for mathematical formulas
\usepackage{amsmath}
% amssymb package, useful for mathematical symbols
\usepackage{amssymb}

% graphicx package, useful for including eps and pdf graphics
% include graphics with the command \includegraphics
\usepackage{graphicx}

% cite package, to clean up citations in the main text. Do not remove.
\usepackage{cite}

\usepackage{color} 

% Use doublespacing - comment out for single spacing
\usepackage{setspace} 
\doublespacing

% Text layout
\topmargin 0.0cm
\oddsidemargin 0.5cm
\evensidemargin 0.5cm
\textwidth 16cm 
\textheight 21cm

% Bold the 'Figure #' in the caption and separate it with a period
% Captions will be left justified
\usepackage[labelfont=bf,labelsep=period,justification=raggedright]{caption}

% Use the PLoS provided bibtex style
\bibliographystyle{plos2009}

% Remove brackets from numbering in List of References
\makeatletter
\renewcommand{\@biblabel}[1]{\quad#1.}
\makeatother

% Leave date blank
\date{}

\pagestyle{myheadings}
%% ** EDIT HERE **

%% ** EDIT HERE **
\usepackage{url}
%% PLEASE INCLUDE ALL MACROS BELOW
\newcommand{\highlight}[1]{{\color{red} \bf{#1}}}
\newcommand{\garycomment}[1]{{\color{green} \bf{Gary: #1}}}
\newcommand{\comment}[1]{{\color{green} \bf{#1}}}
%% END MACROS SECTION

% Article Structure
%    Title which includes the name of the software.
%    Authors and affiliations.
%    Abstract – Fundamental task(s) which the software accomplishes, examples of biological insights from the use of the software, details of availability, including where to download the most recent source code, the license, any operating system dependencies, and support mailing lists.
%    Introduction – A description of the problem addressed by the software and of its novelty and exceptional nature in addressing that problem.
%    Design and Implementation – Details of the algorithms used by the software, how those algorithms have been instantiated, including dependencies. Details of the supplied test data and how to install and run the software should be detailed in the supplementary material.
%    Results – Examples of biological problems solved using the software, including results obtained with the deposited test data and associated parameters.
%    Availability and Future Directions – Where the software has been deposited. Any future work planned to be carried out by the authors, how others might extend the software.
\begin{document}

% Title must be 150 characters or less
\begin{flushleft}
{\Large
\textbf{Chaste: an open source C++ library for computational physiology and biology}
}
% Insert Author names, affiliations and corresponding author email.
\\
Gary R. Mirams$^{1,\ast}$, 
Christopher J. Arthurs$^{1}$, 
Miguel O. Bernabeu$^{2}$, 
Rafel Bordas$^{1}$, 
Jonathan Cooper$^{1}$, 
Alberto Corrias$^3$, 
Yohan Davit$^4$, 
Sara-Jane Dunn$^5$, 
Alexander G. Fletcher$^6$, 
Daniel G. Harvey$^{1}$, 
Megan E. Marsh$^{7}$, 
James M. Osborne$^{1}$, 
Pras Pathmanathan$^{1,8}$, 
Joe Pitt-Francis$^{1}$, 
James Southern$^9$, 
Nejib Zemzemi$^{10}$, 
David J. Gavaghan$^{1}$
\\
\bf{1} Computational Biology, Department of Computer Science, University of Oxford, Oxford, UK
\\
\bf{2} CoMPLEX, Faculty of Maths \& Physical Sciences, University College London, London, UK
\\
\bf{3} Department of Bioengineering, National University of Singapore, Singapore, Singapore
\\
\bf{4} Oxford Centre for Collaborative Applied Mathematics, Mathematical Institute, University of Oxford, Oxford, UK
\\
\bf{5} Computational Science Laboratory, Microsoft Research, Cambridge, UK
\\
\bf{6} Centre for Mathematical Biology, Mathematical Institute, University of Oxford, Oxford, UK
\\
\bf{7} Department of Mathematics and Statistics, University of Saskatchewan, Saskatoon, Canada
\\
\bf{8} Food and Drug Administration, Silver Spring, Maryland, USA
\\
\bf{9} Fujitsu Laboratories of Europe, Hayes Park, London, UK
\\
\bf{10} INRIA, Bordeaux, France
\\
$\ast$ E-mail: \url{gary.mirams@cs.ox.ac.uk}
\end{flushleft}

% Please keep the abstract between 250 and 300 words
% Currently 255
\section*{Abstract}
% PLoS Instructions:
% Fundamental task(s) which the software accomplishes, examples of biological insights from the use of the software, 
% details of availability, including where to download the most recent source code, the license, any operating system dependencies, and support mailing lists.
Chaste --- \textbf{C}ancer, \textbf{H}eart \textbf{A}nd \textbf{S}oft \textbf{T}issue \textbf{E}nvironment --- 
is an open source C++ library for the computational simulation of mathematical models developed for physiology and biology.
Code development has been driven by two initial applications: cardiac electrophysiology and cancer development. 
A large number of cardiac electrophysiology studies have been enabled and performed, including high-performance computational investigations of defibrillation on realistic human cardiac geometry. 
New models for the initiation and growth of tumours have been developed.
In particular, individual-cell-based simulations have provided novel insight into the role of stem cells in the colorectal crypt.
Chaste is constantly evolving and is now being applied to a far wider range of problems. 
The code provides modules for handling common scientific computing components, such as meshes and solvers for ordinary and partial differential equations (ODEs/PDEs).
Re-use of these components avoids the need for researchers to `re-invent the wheel' with each new project, accelerating the rate of progress in new applications.
Chaste is developed using industrial techniques, in particular test-driven development, to ensure code quality, re-use and reliability.
In this article we provide examples that illustrate the types of problems Chaste can be used to solve, which can be run on a desktop computer.
We highlight some of the scientific studies that use of Chaste has enabled, and the insights they have provided.
The source code, both for releases and the development version, is available under an open source BSD licence to download at \url{http://www.cs.ox.ac.uk/chaste}, 
together with details of a mailing list and links to documentation and tutorials.

% Please keep the Author Summary between 150 and 200 words
% Use first person. 
\section*{Author Summary}
% Lay-person summary 

% 200 words exactly at present - if editing keep to this limit.
It is often the case that scientific software is written for a specific purpose, by a single researcher. 
Moreover, such code can be discarded after it has served its purpose, or inherited by a new user who is forced to contend with the style, purpose and possible errors encoded by the original developer, which can delay progress. 
To move away from this convention, and so to accelerate scientific research in computational biology and physiology, we have adopted an industrial approach to software development in the design of Chaste: 
providing a library of commonly required numerical tools within a framework that simplifies the simulation of computational biology problems. 
The Chaste software environment is at the forefront of the cardiac and cell-based modelling fields, being one of the few open source software platforms available for each of these applications. 
Chaste is now regularly used on supercomputing clusters to simulate the activity of the heart, and to investigate cell behaviour in the development of cancers. 
The Chaste infrastructure admits quick extensions for new projects, and we believe there are many components that could be used, and contributed to, by the wider scientific community. 
The code is open source and freely available to download.

% We're at 3495 words not including abstract/summary/refs.

\section*{Introduction}
% PLoS Instructions:
% Introduction – A description of the problem addressed by the software and of its novelty and exceptional nature in addressing that problem.
\textbf{C}ancer, \textbf{H}eart \textbf{A}nd \textbf{S}oft \textbf{T}issue \textbf{E}nvironment (Chaste) has been developed to enable the study of novel problems in computational physiology and biology. The following quotation highlights two problems that Chaste has been designed to overcome:
%Keep this quite short
\begin{quotation}
``Increasingly, the real limit on what computational scientists can accomplish is how quickly and reliably they can translate their ideas into working code.''
G. Wilson \cite{wilson2006s}
\end{quotation}

\textbf{First}, the \emph{speed} at which progress can be made by researchers in our field is typically limited because previously developed models and methods are often not re-used effectively.
At the most practical level, model equations and algorithms are encoded as software (or, more usefully, as mark-up languages for generating software \cite{Cooper2010virtual}), describing unambiguously the computations required for simulations.
In computational physiology and biology, many problems share a need for the same underlying components and numerical schemes.
It is still common for each new PhD student or post-doctoral researcher to `re-invent the wheel' and develop, for example, their own mesh structures, ordinary/partial differential equation (ODE/PDE) solvers and input/output (IO) interfaces. 
This not only slows progress, but a lack of formal software training on structuring and documenting code can lead to `spaghetti code' \cite{Merali2010}. 
Such code rapidly becomes unusable by anyone else, and is typically discarded at the end of a project, requiring the next person to work on the research topic to start the process again.

\textbf{Second}, the \emph{reliability} of code, and subsequent results, is often uncertain and unprovable.
As discussed by Baxter \emph{et al.} in a perspective on software development in this journal \cite{Baxter2006}, there is generally no rigorous software testing approach taken, and testing comes down to whether results `look about right' \cite{Merali2010}. 
This may soon become safety-critical, as clinical interventions become guided by the results of computational biology simulations. 

Both problems discussed above lead to it being very difficult, if not impossible, to guarantee the \emph{reproducibility} of computational results. 
Minimum information standards have been suggested for models (MIRIAM \cite{Novere2005}) and simulations (MIASE \cite{Waltemath2011}), defining vital requirements underpinning reuse and reproducibility.
Mark-up languages such as SBML \cite{hucka2003systems}, CellML \cite{Garny2008}, FieldML \cite{christie2009fieldml} and SED-ML \cite{waltemath2011sed} help to satisfy these requirements in a machine-readable format.
Given the complexity of modern mathematical models and numerical algorithms, we believe the use of such standards in open source software is a pre-requisite for \emph{rapid progress}, \emph{reliability} and \emph{reproducibility}.

To date, our primary applications have been in computational physiology and biophysics.
In these fields, a wide array of models are represented as continuum ODE/PDE problems, individual or agent-based discrete models, or a hybrid of these two. 
Examples of problems falling into these categories include cardiac electrophysiology and electromechanics, tumour growth, and developmental biology. 
In 2005, we began to build Chaste as a software environment that could be used for simulation of these types of problem, which would overcome many of the pitfalls discussed above. 
To achieve this, Chaste comprises a library of fully-tested modules for the common elements of these biological exemplars, which can be easily utilised and readily extended for the simulation of novel models, and the use of novel numerical algorithms. 

Other notable open source codes include OpenCMISS for continuum modelling \cite{Bradley2011}, CompuCell3D for cellular Potts modelling \cite{Cickovski2007} and MultiCellXML for agent-based modelling and simulation data \cite{Macklin2012}. 
Chaste is unique in being well suited for both continuum and discrete modelling approaches, and is in an excellent position to investigate hybrid approaches \cite{Osborne2010}.
%Chaste is exceptional in being the only open source software available for many of its application areas, and also in the use of industrial software engineering standards for its development. 

Release 1.0 of Chaste occurred in 2009 and has been described previously \cite{Bernabeu2008,pitt2009chaste}. 
Through the use of examples, we will describe the capabilities of version 3.1, novel scientific applications that have been made possible, and future directions. 
It is our intention that all of the examples in this article can be easily reproduced on a desktop PC;
they are therefore less computationally intensive than many of the simulations performed in active research.
The example simulations can be run, and figures recreated, by downloading the associated Chaste project from \url{http://www.cs.ox.ac.uk/chaste/download}, as described in the Supplementary Material.

\section*{Design and Implementation}
% PLoS Instructions:
%     Design and Implementation:
%         Details of the algorithms used by the software, 
%         how those algorithms have been instantiated, including dependencies. 
%         Details of the supplied test data and how to install and run the software
%         should be detailed in the supplementary material.

%\cite{Baxter2006}  --- PLoS perspective on scientific software design and implementation.
%``1) design the project upfront;'' --- `` ''What will the program(s) do?’’ and
%``How will the results produced by the program be verified?’’ '' (we have adapted this as our motivation for test-driven development, but we don't plan too much ahead.)
%``2) document programs and key processes; 
%3) apply quality control; 
%4) use data standards where possible; 
%and 5) incorporate project management.''

In this section, we discuss the Chaste development strategy, as this is fundamental to its properties, capabilities and extensibility for novel problems.
We then introduce the code layout and the available model types and algorithms.
Chaste is written in C++, a compiled language that allows object-oriented class definitions.
This makes the code suitable for applications where efficient memory management and performance are key, but also allows simple extension and inheritance of existing functionality.

\subsection*{Development Strategy}

We have found the following practices invaluable in terms of rapid development, delivering fast performance, and ensuring reliable results.

\subsubsection*{Test-driven development}

Test-driven development is fundamental to our efforts, and is the opposite of the usual approach taken by computational scientists. 
In this style of development, `test code' is written \emph{before} the `source code' which will actually perform the function we require.
Once a test is in place, the source code is then written to make the test pass.
This has the advantage of forcing developers to consider the best interface for their new code, and to consider how to test that the source code performs its function correctly. 

The test code is committed to the central repository alongside the source code that it tests.
Upon each commit, all the tests are run in order to check that no functionality has been inadvertently broken.
This ensures the code always performs as intended, and developers `protect' their new code from any future changes to either the code itself, or any code it relies on.
This approach does not guarantee bug-free code, but in practice makes bugs very rare.
When bugs do occur, this is typically because functionality is expected that has not been fully tested, and the first step in the solution is to write more tests.

Additional tests are run each night, which: check all of the standard tests for memory leaks; 
profile certain tests for speed; 
check for documentation on all source code; 
and check that every line of the source code is called by at least one of the tests.
Among all the coding practices we use, \emph{test-driven development} is never discarded, and is the feature most highly regarded by the development team, who commonly apply it to their other projects.

\subsubsection*{Agile programming}
Chaste is developed using an `agile' development methodology, using many features of eXtreme Programming (XP) \cite{beck1999embracing}.
A feature of this approach is to avoid planning too far ahead at any stage.
This limits the scope of coding work at any time to a goal that is achievable in a reasonable time frame (typically one month).

This approach allows the fast development of working prototypes, and removes `paralysis through planning', which can occur when trying to accommodate a myriad of possible future requirements.
However, significant time is spent re-working existing code: class structures and interfaces are reorganised for efficiency, readability and ease of re-use. 
Overall, this approach generates effective code over time and flexibility is added as required.

We have also adopted some other characteristics of XP, notably pair programming. 
Ideally, all contributed code is written by a pair of developers, sitting side by side, with one writing code, and the other checking and suggesting improvements.
In an academic setting, we have found that this need not be insisted upon, but we use it in regular coding sessions.
Pair programming has additional benefits --- no single person takes sole responsibility for any part of the code.
This is especially useful in an academic setting, as people move on to new projects frequently.

\subsubsection*{Coding standards}

Simple rules are adhered to for the naming of variables, methods and classes, which enables developers to navigate their way through the code efficiently, and makes mistakes less likely. 
In addition a standardised code layout is adopted, with in-line documentation, which makes the code more readable.
This is made easier by using the Eclipse IDE (\url{http://www.eclipse.org}) \cite{allowatt2005ide}, to allow developers to share a code layout specification.
The documentation is compiled into an auto-generated website, publicly available, using doxygen (\url{http://www.doxygen.org}).
%We have a standard approach for other technicalities unique to C++, which are similar to some of the Joint Strike Fighter C++ standards \cite{jsf}.
Other C++ standards are documented and publicly accessible on the Chaste wiki \url{https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi}.

\subsection*{Code Layout and Design}
Chaste provides libraries for code which is common to many computational biology problems. 
Here we briefly describe the components of the code base and their capabilities.
We will present and discuss example simulations, and the new scientific insight Chaste has enabled, in the Results section.

%\comment{JC: Should we add footnote URLs for the various external packages mentioned?}
% PloS Comp Biol doesn't seem to have footnotes, so I think Supplementary Material table will have to do.
\begin{itemize}
 \item \texttt{global} --- contains code for basic mathematics (including a random number generator), time stepping, checkpointing (saving and loading simulations) using the Boost serialization library \cite{karlsson2005beyond}, parallel vector classes, and code to handle warnings and errors.
 \item \texttt{io} (input/output) --- code for reading, writing and conversion of various file formats, together with modules to handle the HDF5 scientific file format \cite{folk1999hdf5}, which enables distributed data to be collated and stored in a single file.
 \item \texttt{mesh} --- code for storing linear or quadratic tetrahedral meshes and vertex meshes in memory; nodes, elements, boundary properties; mesh generation; mesh distribution using METIS/parMETIS \cite{karypis1998fast}; readers and writers for Triangle/TetGen \cite{shewchuk96b,si2005}, Meshalyzer, Cmgui and VTK (Paraview) formats.
 \item \texttt{linalg} (linear algebra) --- code which uses Boost uBLAS and PETSc \cite{petsc} for vector and matrix operations.
 \item \texttt{ode} --- code for defining ODEs; solvers, basic finite difference schemes, CVODE \cite{hindmarsh2005sundials}; termination on root-finding capabilities.
 \item \texttt{pde} --- code for defining elliptic and parabolic second-order PDEs; parallel finite element solvers of generic coupled systems of PDEs (using \texttt{mesh} and \texttt{linalg}).
 \item \texttt{continuum\_mechanics} --- code for solving compressible and incompressible general non-linear elasticity problems.
\end{itemize}

These core components are used by two main application components that have driven Chaste development to date --- \texttt{cell\_based} and \texttt{heart}. These will be discussed in the Results section.

\subsubsection*{Projects}

We support `bolt-on' projects for individual studies using Chaste. 
This allows storage of code in the version-control repository, and provides an interface to the testing framework.
We aim to release a project with each new publication, allowing all of the results and figures in an article to be reproduced with a given version of Chaste.
See the Supplementary Material for instructions on downloading the project associated with this article.
If common code occurs in more than one user project, then generally it is moved to the central Chaste repository, thus becoming publicly available.

\section*{Results}
% PloS Instructions:
%    Results – Examples of biological problems solved using the software, 
%    including results obtained with the deposited test data and associated parameters.
Here we provide some examples of the types of scientific problems that Chaste has been used to investigate to date.
This section is structured around four examples, which can all be reproduced by running the tests in the project accompanying this paper. 
Each example is simple, so as to enable reproduction on a typical desktop PC. 
The code for each example is available to download as part of the supplementary material, and can also be found at \protect\url{https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/wiki/PaperTutorials/Plos2012} 
where the codes are presented in tutorial-style wiki pages.
For examples of state-of-the-art scientific results obtained using Chaste, please refer to the papers cited herein.

% What we (and others) have used Chaste for to date. Organise this around 4 figures/movies in supplementary material.
% \begin{enumerate}
%  \item Figure~\ref{fig:FourCrypts}: Ozzy node-based multiple crypts and villus 
%  \item Figure~\ref{fig:SpiralWave}: Spiral wave
%  \item Figure~\ref{fig:TwistyWedge}: Pras twisty wedge 
%  %\item Figure~\ref{fig:Butterfly}: Alex Butterfly? This is going in CPC.
%  \item Figure~\ref{fig:DeltaNotchFootball}: Delta-Notch football pattern?
% \end{enumerate}

\subsection*{Cell-based}

The \texttt{cell\_based} code provides a range of modelling frameworks for individual-cell-based simulations.
Common code is provided for cell-cycle models, cell death events, intracellular signalling pathways, and for coupling to PDEs, e.g. for the diffusion of nutrients or oxygen. 
For cellular simulations, there are two main types of model: on- and off-lattice.

\textbf{On-lattice} models which are supported include cellular automata (1--3D) \cite{moreira2002cellular}, in which each lattice site is associated with one or more cells.
Advanced models of angiogenesis have been built using the cellular automata framework \cite{perfahl2011multiscale}.
Cellular Potts models are also available (1--3D), in which a cell occupies a number of lattice sites \cite{Graner1992Simulation,Cickovski2007}, and additional sites are included or removed to minimize an energy function.

\textbf{Off-lattice} models fall into two main types, with cells being defined spatially by (i) their centres, or (ii) their vertices:

(i) In cell-centre models cells are represented by points, which move according to interactions with neighbouring cells that can be defined in two main ways: 
node-based (1--3D), where neighbours are any nodes within a certain interaction distance;
or mesh-based (1--3D), where neighbours are nodes which share elements of a mesh (defined by a Delaunay triangulation of the cell centres).

(ii) Vertex dynamics models (2D) represent cells as polygons whose vertices move in response to forces. 
%Cells are defined by the vertices of their polygonal perimeter, these move according to energy minimization formulae of various types - \highlight{list Nagai-Honda, Weiliky Oster etc. here perhaps a sentence on each, include a generic energy minimization equation here?, cite ...}.
%It is standard to make the simplifying assumption that the motion of vertices is over-damped \cite{Drasdo2000}, and inertial terms are small compared to dissipative terms.
%This leads to first-order dynamics, with the evolution of the position ${\bf r}_i$ of each vertex $i$ determined by
%\begin{align}
%\eta_i \frac{\mathrm{d}{\bf r}_i}{\mathrm{d}t} & = {\bf F}_{i}\,,
%\end{align}
%\noindent where ${\bf F}_{i}(t)$ denotes the total force acting on vertex $i$ at time $t$ and $\eta_i$ denotes its drag coefficient. 
In some vertex dynamics models, a free energy function is specified, whose gradient is assumed to exert a force on each vertex \cite{Honda1980}. 
Elsewhere, the forces acting on each vertex are provided explicitly \cite{Weliky1990}. 
An extension of vertex models to 3D is planned for future work.
\highlight{Depending on when this paper is submitted, cite the Chaste vertex paper if it has been accepted!} 

We have used Chaste to examine the suitability of these different modelling paradigms for the same biological problem, highlighting any idiosyncrasies \cite{Pathmanathan2009,Osborne2010}.

FIGURE~\ref{fig:TumourSpheroid} HERE.

Our first example uses an off-lattice mesh based 3D simulation, coupled to a PDE.
The PDE boundary condition is a fixed oxygen concentration at the spheroid surface, oxygen diffuses and is taken up by cells.
In low oxygen conditions cells cease to proliferate, and in very low conditions they die, leaving a void in the centre of the spheroid (see Figure~\ref{fig:TumourSpheroid} and video S1), as observed in experiment.

A specialist \texttt{crypt} code component has been developed to study intestinal crypts and the initiation of colorectal cancer. 
This component includes code to define the intestinal crypt geometry, Wnt signalling pathway and intestinal cell-cycle models. 
In van Leeuwen \emph{et al.} \cite{VanLeeuwen2009}, monoclonal conversion was predicted in the colorectal crypt as a result of postulated simple competition in the stem cell population, which has since been confirmed experimentally \cite{lopez2010intestinal}.
We have extensively used the Chaste off-lattice mesh-based simulations to examine the concept and role of stem cells in crypt homeostasis \cite{fletcher2012mathematical,Mirams2012CryptInvasion} as well as the contribution of mechanical effects to cell behaviour \cite{Dunn2012,Dunn2012Plos}. 
A model hypothesis related to cellular extrusion in the crypt \cite{Dunn2012Plos} was verified experimentally in independent investigations, published at a similar time \cite{Eisenhoffer2012}. 

FIGURE~\ref{fig:FourCrypts} HERE.

In Figure~\ref{fig:FourCrypts} we present an example based on the intestinal epithelium: a 3D off-lattice node-based simulation confined to a 2D surface.
In this simulation of a small intestinal villus surrounded by four crypts, cells move according to a nearest-neighbour-defined repulsive force.
Over the course of the simulation each of the four crypts becomes monoclonal, leading to a villus carrying each of the four clonal populations  (see video S2).
In addition, each cell is carrying an ODE system for Delta-Notch signalling, which takes as an input the average Delta level of the neighbours \cite{collier1996pattern}.
This leads to a dynamic pattern of Delta-Notch with high/low activity in neighbouring cells, thought to lead to differentiation into secretory and absorbative cells \cite{crosnier2006organizing}.

\subsection*{Heart}

The \texttt{heart} component of Chaste provides fast and accurate solution of electro-mechanical problems on large meshes, optimised for high-performance computing facilities by using PETSc for parallel linear algebra, and (par)METIS for mesh distribution \cite{bordas2009simulation}.

Simulations can be performed based upon single-cell ODE systems using CVODE, or at the tissue/whole-organ level using PDE formulations such as monodomain, bidomain, bidomain-with-bath, \comment{[need ref here]} and our new extended-bidomain system \cite{corrias2012modelling}.
Heterogeneities in fibre directions and cell models can be included, and post-processing can be performed to obtain quantities such as action potential durations, pseudo-ECGs \cite{gima2002ionic}, and conduction velocities.

FIGURE~\ref{fig:SpiralWave} HERE. 

In Figure~\ref{fig:SpiralWave} we present a snapshot of a 2-D monodomain simulation which reproduces one of the results of a study into electrical wave dynamics \cite{Qu2000Origins} (see video S3).
A stable re-entrant spiral wave is generated on a 3cm $\times$ 3cm mesh, by appropriate stimulation and alteration of ion-channel expression in a cardiac action potential model \cite{Luo1991Model}.
Such behaviour of electrical waves is commonly studied to understand how changes to ion-channel dynamics, through disease or drug block, can lead to the onset of fatal arrhythmias.

Recently we have also begun to work on electromechanics \cite{Pathmanathan2010}, this becoming publicly available from v3.0 onwards. 
We use this electromechanics code for our final example in Figure~\ref{fig:TwistyWedge}.
Deformation occurs due to cellular tension development in response to electrical activation and calcium release, coupled to a model of mechanical properties of cardiac tissue.
Figure~\ref{fig:TwistyWedge} shows varying fibre directions throughout a 3-D block of tissue, alongside the spread of an electrical wave, and subsequent deformation (see also video S4).

FIGURE~\ref{fig:TwistyWedge} HERE.

The development of a mesh of the human heart embedded within a torso enabled us to simulate the 12-lead human body surface ECG, and to predict ECG changes under drug action \cite{zemzemi2012}. 
These techniques may soon be used to predict the results of human clinical trials during drug development, to improve the attrition rates in drug development, and to prevent dangerous drugs reaching the market \cite{Mirams2011,mirams2011time,Mirams2012}.
Simulations have also been performed to study defibrillation of a human heart in arrhythmia \cite{bernabeu2010shock}, with a view to improving medical devices and interventions.

Dynamic loading and units conversion of CellML files \cite{Cooper2011cuc} have enabled studies that consider the extensive variability between different models \cite{Pathmanathan2011,Mirams2011,Cooper2011}.
Our group has also used Chaste to study the effect of stochasticity in cardiac models \cite{Walmsley2012,Dutta2011,Pueyo2011}, a cause of variability in experimental recordings, and potentially linked to pro-arrhythmic risk.

Improvements to the numerical algorithms used in cardiac simulation have been a large focus of our research efforts, and have enabled the novel biological problems above to be studied. 
We have focussed on efficient solution of action potential models \cite{Cooper06,Cooper2011cuc,Marsh2012}, matrix preconditioners \cite{Bernabeu2009a,Bernabeu2010}, adaptivity \cite{Southern2012Parallel}, and choice of finite element formulation \cite{Pathmanathan2010ngb,Pathmanathan2011,arthurs2012efficient}.

Chaste displayed exceptional performance in terms of accuracy and convergence properties in a recent independent study surveying major cardiac electro-physiology solvers~\cite{niederer2011verification,pathmanathan2011computational}.
Independent benchmarking has shown good scaling to 2048 cores \cite{Strazdins2011}, with further improvements recently \cite{bernabeu2012}.

\subsection*{Other application areas}
The Chaste library has found applications in other areas of computational biology. 
Over the last decade, there has been a strong interest in building a multi-scale modelling framework to study the contractile function of the human gastrointestinal system \cite{Sanders2006,Buist2010}.  
%The organs along the GI tract are larger than the heart and their electrophysiology arguably even more complex \cite{Sanders2006}. 
The authors have used Chaste to integrate the detailed cellular electrophysiology of the stomach into a whole organ framework with a view to studying the effects of genetic mutations as well as diseases such as diabetes \cite{corrias2012modelling, CDB13}.

A number of other groups are using Chaste for a large variety of simulations, including: 
lattice-based multiple occupancy cellular automata (Markus Owen, University of Nottingham);  % approved
the effects of radiation on tissue (Shaowen Hu, NASA); % approved
sexually transmitted infection modelling (Martin Nelson, University of Nottingham); % approved
cardiac electrophysiological modelling (US Government Food and Drug Administration); % approved
drug-induced changes to cardiac rhythm (Safety Pharmacology, GlaxoSmithKline); % approved
and neuron electrophysiology (Andres Agudelo-Toro, Max Planck Institute University of G\"{o}ttingen). % approved

\section*{Availability and Future Directions}
% PLoS Instructions:
%    Availability and Future Directions – Where the software has been deposited. 
%    Any future work planned to be carried out by the authors, how others might extend the software.
%\subsection*{Availability}
Chaste is freely available to download from \url{http://www.cs.ox.ac.uk/chaste}. 
Releases 1.0 -- 3.0 were under the LGPL v2.0 licence, while v3.1 and future releases are under the more flexible 3-clause BSD licence, to facilitate use of the code by industrial partners.

%\subsection*{Future Directions}

Currently, we are adding support for the following types of simulation: 
parallel cardiac electro-mechanics; 
His-Purkinje system in cardiac electrophysiology; 
lung mechanics; 
import of SBML models for signalling pathway and cell-cycle models; 
fluid flow for haemodynamics and airflow.
We are investigating ways to make it easier for users to contribute code, and aim to support a Microsoft Windows environment in the next year.

\subsection*{How to become an active developer}

The main Chaste website is at \url{http://www.cs.ox.ac.uk/chaste}, from here you can sign up to the users mailing list to receive announcements of new versions and support from users and developers.
You can also register to create a login for the Chaste wiki to view and comment on work tickets, and submit patches for inclusion in Chaste.
In addition to the examples associated with this article we have a large number of tutorials that are easy to adapt to perform many types of simulation. 
There is a guide for people who would like to work with the latest development version of Chaste here:\\
\url{https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/wiki/ChasteGuides/ExternalDeveloperGuide}

% Do NOT remove this, even if you are not including acknowledgements
\section*{Acknowledgements}
\highlight{Gary: Please add in any funding acknowledgements you want - e.g. DTC funding.}
The authors gratefully acknowledge the following sources of financial support:
GlaxoSmithKline Grants and Affiliates Award to GRM and DJG; 
EPSRC e-Science pilot project in Integrative Biology (GR/S72023/01);
EPSRC, Software for High Performance Computing project (EP/F011628/1);
European Commission, Prediction of Drug Impact in Cardiac Toxicity (PreDiCT), Framework 7 grant (DG-INFSO 224381);
2020 Science: EPSRC and Microsoft Research, Cambridge through grant EP/I017909/1 (\url{www.2020science.net});
BBSRC grant to Oxford Centre for Integrative Systems Biology (BB/D020190/1);
EPSRC via Oxford Life Sciences Interface Doctoral Training Centre.
This publication was based on work supported in part by Award No. KUK-C1-013-04, made by King Abdullah University of Science and Technology (KAUST).


%\section*{References}
% The bibtex filename
\bibliography{refs}

\section*{Figure Legends}

% \begin{figure}[!htbp]
% \begin{center}
% %\includegraphics[width=4in]{images/schematic.eps}
% \end{center}
% \caption{
% {\bf Overall schematic of the code?}  
% Caption.
% }
% \label{fig:OverallSchematic}
% \end{figure}

\begin{figure}[!htbp]
\begin{center}
\includegraphics[width=0.6\linewidth]{images/spheroid.eps}
%\includegraphics[width=0.6\linewidth]{images/MeshBasedSpheroidVtkAsPointsCrossSection.eps}
\end{center}
\caption{
{\bf 3D off-lattice simulation coupled to PDE: 3D simulation of a tumour spheroid.}
A cross-section of a tumour spheroid is presented. 
Cell centres, nodes of a mesh, are represented by spherical shells and coloured according to the local oxygen concentration. 
Proliferation is dependent on oxygen, which diffuses and is taken up by cells in the spheroid, such that only cells near the outer rim divide. 
Cell death occurs under low oxygen conditions near the centre of the spheroid.
%\highlight{See also MeshBasedSpheroidVtkAsPointsCrossSection.avi.}
}
\label{fig:TumourSpheroid}
\end{figure}

\begin{figure}[!htbp]
\begin{center}
\includegraphics[width=0.99\linewidth]{images/multi_crypt.eps}
\end{center}
\caption{
{\bf 3D off-lattice simulation confined to a 2D surface: small intestinal crypts and villus}.  
Left: cells are labelled according to their ancestor cell; 
each crypt gives rise to a monoclonal population, with a multiclonal villus comprised of cells from each crypt. 
Right: the same simulation, here with cells labelled according to Delta levels (non-dimensionalised); 
Delta-Notch patterning occurs due to a signalling model inside each cell, which depends on the activity of neighbouring cells, 
and is thought to lead to differentiation into secretory and absorbative cell types.
}
\label{fig:FourCrypts}
\end{figure}

\begin{figure}[!htbp]
\begin{center}
\includegraphics[width=0.5\linewidth]{images/spiral_wave.eps}
\end{center}
\caption{
{\bf Cardiac electrophysiology: a re-entrant spiral wave}.
This figure displays the membrane voltage in a 2-D 3cm $\times$ 3cm monodomain simulation using the Luo-Rudy 1991 action-potential model \cite{Luo1991Model} with the modifications and protocol suggested in \cite{Qu2000Origins}.
}
\label{fig:SpiralWave}
\end{figure}

\begin{figure}[!htbp]
\begin{center}
\includegraphics[width=0.95\linewidth]{images/twisty_cube.eps}
% \includegraphics[width=0.35\linewidth]{images/cube_fibre_directions.eps}
% \phantom{aaa} % so fibres colourbar is closer to fibre figure than voltage/deformation figures
% \includegraphics[width=0.28\linewidth]{images/cube_time1.eps}
% \includegraphics[width=0.28\linewidth]{images/cube_time35.eps}
\end{center}
\caption{
{\bf Cardiac electromechanics in a ventricular wedge:} left, fibre orientation relative to Z axis; middle and right, simulation of electrical propagation and deformation (middle: 1ms after stimulus on left face ($x=0$); right: 35ms after stimulus).
}
\label{fig:TwistyWedge}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Any tables in the document go here.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section*{Tables}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% THIS WILL BE ONLINE - NOT TO BE INCLUDED IN WORD COUNT
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
\section*{Supplementary Material}

Supplementary material for the paper ``\textbf{Chaste: an open source C++ library for computational physiology and biology}''
consists of
\begin{itemize}
    \item This article, providing installation instructions and detail on Chaste dependencies.
    \item A Chaste `project' download, also available at \url{http://www.cs.ox.ac.uk/chaste/download} in the ``Bolt-on Projects'' section.
    \item Video S1 --- the simulation giving rise to Figure~\ref{fig:TumourSpheroid}.
    \item Video S2 --- the simulation giving rise to Figure~\ref{fig:FourCrypts}.
    \item Video S3 --- the simulation giving rise to Figure~\ref{fig:SpiralWave}.
    \item Video S4 --- the simulation giving rise to Figure~\ref{fig:TwistyWedge}.
\end{itemize}


\section{Installation}

In this section we summarise how to install and run Chaste. 
There are links to all the relevant information from the Chaste wiki page associated with this paper:
\url{https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/wiki/PaperTutorials/Plos2012}.


The simplest method is to use the Ubuntu Linux operating system, as a package is available for this platform.
Instructions for this can be found at \url{https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/wiki/InstallGuides/UbuntuPackage}.
In practice many users find it easiest to install Chaste on a virtual machine running Ubuntu, if no Ubuntu machine is available.

Chaste can also be installed on any other Linux system. 
Manual installation of a number of dependencies is required, but scripts are provided to simplify this process.
Up-to-date instructions can be found at \url{https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/wiki/InstallGuides}.

A bolt-on project \texttt{Plos2012} has been made available that reproduces all of the examples in the article.
It is available to download from the ``Bolt-on projects'' tab on the main Chaste download site: \url{http://www.cs.ox.ac.uk/chaste/download.html}.

\newpage
\section{Dependencies}

\begin{table}[!ht]
    \caption{
    \textbf{Chaste Dependencies.} For the full text of all licences examine the contents of \protect\url{docs/licences.html} 
    or visit \protect\url{https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/export/14566/trunk/docs/Licences.html}
    \comment{JC: Update to a release version.}
    \\ $^*$ indicates that the software is packaged with Chaste.}
    \begin{tabular}{|l|l|l|}
      \hline
      Dependency & Available from & Licence \\
\hline
Amara & \url{http://wiki.xml3k.org/Amara} & Apache 1.1\\
Boost & \url{http://www.boost.org} & Custom\\
CodeSynthesis XSD &  \url{http://codesynthesis.com/products/xsd} & GPL\\
CVODE (SUNDIALS) & \url{https://computation.llnl.gov/casc/sundials} & BSD\\
CxxTest$^*$ & \url{http://cxxtest.tigris.org}  & LGPL\\
HDF5 &  \url{http://www.hdfgroup.org/HDF5/HDF5.txt} & Custom\\
(Par)METIS &  \url{http://glaros.dtc.umn.edu/gkhome/views/metis} & Custom\\
MPICH, or&  \url{http://www.mcs.anl.gov/research/projects/mpich2} & Custom\\
Open MPI & \url{http://www.open-mpi.org} & BSD\\
PETSc &  \url{http://www.mcs.anl.gov/petsc} & Custom\\
Pyparsing &  \url{http://pyparsing.wikispaces.com} & MIT\\
RDFLib &  \url{https://github.com/RDFLib} & BSD\\
RNV &  \url{http://www.davidashen.net/rnv.html} & BSD\\
TetGen$^*$ &  \url{http://tetgen.berlios.de}  & Custom\\
Triangle$^*$ & \url{http://www.cs.cmu.edu/~quake/triangle.html}  & Custom\\
VTK &  \url{http://www.vtk.org} & BSD\\
Xerces &  \url{http://xerces.apache.org/xerces-c} & Apache 2 \\
      \hline
    \end{tabular}
    \begin{flushleft}
    \end{flushleft}
    \label{tab:ChasteDependencies}
\end{table}

\end{document}

